function getBrowse(){var browser={};var userAgent=navigator.userAgent.toLowerCase();var browser={ie:userAgent.match(/msie ([\d.]+)/),firefox:userAgent.match(/firefox\/([\d.]+)/),chrome:userAgent.match(/chrome\/([\d.]+)/),opera:userAgent.match(/opera.([\d.]+)/),safari:userAgent.match(/version\/([\d.]+).*safari/),};var versions=[`IE${browser.ie}`,'Firefox','Chrome','Opera','Safari'];var _versions=[`ie`,'firefox','chrome','opera','safari'];var browserIndex=_versions.findIndex(function(_browser){return browser[_browser]!==null});if(browserIndex===-1){return'未知浏览器'}return versions[browserIndex]}function getOS(){var sUserAgent=navigator.userAgent;if(/Android|webOS|iPhone|iPad|BlackBerry/i.test(sUserAgent))return'phone';var isWin=navigator.platform=='Win32'||navigator.platform=='Windows';var isMac=navigator.platform=='Mac68K'||navigator.platform=='MacPPC'||navigator.platform=='Macintosh'||navigator.platform=='MacIntel';if(isMac)return'Mac';var isUnix=navigator.platform=='X11'&&!isWin&&!isMac;if(isUnix)return'Unix';var isLinux=String(navigator.platform).indexOf('Linux')>-1;if(isLinux)return'Linux';if(isWin){var isWin2K=sUserAgent.indexOf('Windows NT 5.0')>-1||sUserAgent.indexOf('Windows 2000')>-1;if(isWin2K)return'Win2000';var isWinXP=sUserAgent.indexOf('Windows NT 5.1')>-1||sUserAgent.indexOf('Windows XP')>-1;if(isWinXP)return'WinXP';var isWin2003=sUserAgent.indexOf('Windows NT 5.2')>-1||sUserAgent.indexOf('Windows 2003')>-1;if(isWin2003)return'Win2003';var isWinVista=sUserAgent.indexOf('Windows NT 6.0')>-1||sUserAgent.indexOf('Windows Vista')>-1;if(isWinVista)return'WinVista';var isWin7=sUserAgent.indexOf('Windows NT 6.1')>-1||sUserAgent.indexOf('Windows 7')>-1;if(isWin7)return'Win7';var isWin10=sUserAgent.indexOf('Windows NT 10')>-1||sUserAgent.indexOf('Windows 10')>-1;if(isWin10)return'Win10'}return'other'}function loadScript(url,attributesParam,optsParam){var attributes=attributesParam||{};var opts=optsParam||{};var script=document.createElement('script');if(attributes.defer===undefined){attributes.defer=true}if(opts.async===undefined){attributes.async=true}for(var attributeKey in attributes){script.setAttribute(attributeKey,attributes[attributeKey])}script.src=url;script.onload=function(){if(opts.onload)opts.onload()};script.onerror=function(){if(opts.onerror)opts.onerror()};var _loadScript=function(){if(opts.appendBody){var body=document.getElementsByTagName('body')[0];body.appendChild(script)}else{var lastScript=document.getElementsByTagName('script')[0];lastScript.parentNode.insertBefore(script,lastScript)}};if(opts.timeout){setTimeout(function(){_loadScript()},opts.timeout)}else{_loadScript()}}function errorHandler(res){var data={};data.os=getOS();data.browser=getBrowse();if(!window.vm){localStorage.setItem('hangAnalyze',JSON.stringify(data))}errorTip()}function errorTip(err){if(err){console.log('errorTip: ',err)}var _agent=window.navigator.userAgent.toLowerCase();var _system=_agent.split(' ')[1].split(' ')[0].split('(')[1].replace(';','');var macCache='';var macFresh='';var winCache='';var winFresh='';if(_system==='macintosh'){macCache=`<img src="https://lanhustatic.oss-cn-beijing.aliyuncs.com/lanhu-hang-image/mac-del-cache.svg">`;macFresh=`<img src="https://lanhustatic.oss-cn-beijing.aliyuncs.com/lanhu-hang-image/mac-fresh.svg">`}else if(_system==='windows'){winCache=`<img src="https://lanhustatic.oss-cn-beijing.aliyuncs.com/lanhu-hang-image/win-del-cache.svg">`;winFresh=`<img src="https://lanhustatic.oss-cn-beijing.aliyuncs.com/lanhu-hang-image/win-fresh.svg">`}var domApp=document.getElementById('app');if(!domApp){console.warn('not found app dom');return}domApp.innerHTML=`<div class="hang-wrapper"><p class="error-title">加载遇到问题</p><p class="error-step">需2两步操作，恢复正常访问</p><p class="error-step-one">第一步：强制刷新</p><p class="error-step-one-info">快捷键${_system==='macintosh'?macFresh:winFresh}</p><p class="error-step-two">第二步：清除浏览器缓存</p><p class="error-step-two-info">可在浏览器设置内手动清理或打开新标签页按${_system==='macintosh'?macCache:winCache}</p><p class="error-help-group-num">如果还未解决你的问题，可加QQ群894954401</p></div>`}function errorTipInit(global){global._errorHandler=errorHandler;global.addEventListener('error',global._errorHandler);global.getBrowse=getBrowse;global.errorHandler=errorHandler;global.errorTip=errorTip;global.getOS=getOS;global.loadScript=loadScript}errorTipInit(window);
